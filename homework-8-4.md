# Виртуальные таблицы остатков и оборотов

## Задание 1

### Описание задачи

Реализовать расчет себестоимости товаров, списываемых со счета 41, по данным виртуальной таблицы "Остатки" регистра бухгалтерии.

### Требование к результату

Выгрузка информационной базы (.dt) с конфигурацией из предыдущего задания, в которой логика определения себестоимости товара, списываемого документом **РеализацияТоваровИУслуг** со счета 41 "Товары", реализована не обращением к остаткам регистра накопления **Товары**, а обращением к виртуальной таблице **Остатки**.

### Процесс выполнения

Используйте конфигурацию из предыдущего заданиия.

1. Удостоверьтесь в том, что:

* В плане счетов **Управленческий** есть предопределенный счет 41 "Товары", а у него - субконто "Номенклатура" (СправочникСсылка.Номенклатура).
* В регистре бухгалтерии **Управленческий** есть ресурсы **Количество** и **Сумма**, и по счету 41 и по субконто Номенклатура ведется суммовой и количественный учет.
* Документы **ПоступлениеТоваровИУслуг** и **РеализацияТоваровИУслуг** формируют движения по Дт и Кт счета 41 с указанием субконто, суммы и количества.

2. Обработчик проведения документа **РеализацияТоваровИУслуг** доработайте так:

* Получите остатки счета 41 на момент времени документа с отбором по счету 41 и по номенклатуре из табличной части ("Субконто1 В (&Номенклатура)"). Отбор накладывайте параметрами временной таблицы.
* Код, рассчитывающий среднюю стоимость списываемого товара по данным регистра накопления, дополните кодом, определяющим среднюю стоимость списываемого товара по данным из остатков счета 41. Движения по регистру накопления **Товары** должны учитывать данные этого регистра, а движения по регистру бухгалтерии - данные регистра бухгалтерии.

3. Удостоверьтесь в том, что после проведения поступлений и реализаций движения по регистру накоплеия **Товары** и по счету 41 не расходятся.
