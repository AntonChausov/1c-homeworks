# Диплом блока B "Товарно-денежный учет"

## Описание задачи
Развить созданную в блоке Б конфигурацию "Управление ИТ-фирмой", обеспечив возможность учета хозяйственных операций по приобретению и реализации товаров и услуг с базовыми механизмами ценообразования и набором простых отчетов.

## Требования к результату

Конфигурация с именем "УправлениеИТФирмой" из диплома блока А, дополненная:

* Документом Поступление, который:
** Содержит реквизит шапки Поставщик и табличную часть ТоварыИУслуги с реквизитами Номенклатура, Количество, Цена, Сумма, СтавкаНДС, СуммаНДС
** Имеет форму, в которой реализован выбор и подбор номенклатуры с автоматическим пересчетом числовых колонок по правилам:
*** При изменении реквизитов Количество и Цена пересчитывается Сумма и СуммаНДС (см. ниже "Правила расчета НДС")
*** При изменении реквизита Сумма пересчитывается Цена и СуммаНДС
*** При изменении реквизита СтавкаНДС пересчитывается СуммаНДС 
** Формирует движения:
*** Расход по регистру накопления Взаиморасчеты с указанием поставщика в сумме общего итога по реквизиту ТЧ Сумма
*** Приход по регистру накопления Товары в разрезе номенклатуры типа Товар согласно реквизитам ТЧ Количество и Сумма
*** Движения по регистру накопления Расходы в разрезе номенклатуры типа Услуга согласно реквизиту ТЧ Сумма

* Документом Реализация, который:
** Содержит реквизит шапки Покупатель и табличную часть ТоварыИУслуги с реквизитами Номенклатура, Количество, Скидка, Цена, Сумма, СтавкаНДС, СуммаНДС
** Имеет форму, в которой реализован выбор и подбор номенклатуры с автоматическим назначением цены и скидки, а также пересчетом числовых колонок по правилам:
*** При изменении реквизитов Количество и Цена пересчитывается Сумма (с учетом скидки) и СуммаНДС (см. ниже "Правила расчета НДС")
*** При изменении реквизита Скидка пересчитывается Сумма и СуммаНДС
*** При изменении реквизита Сумма пересчитывается Скидка (цена остается прежней) и СуммаНДС
*** При изменении реквизита СтавкаНДС пересчитывается СуммаНДС
** Формирует движения:
*** Расход по регистру накопления Взаиморасчеты с указанием поставщика в сумме общего итога по реквизиту ТЧ Сумма
*** Приход по регистру накопления Товары в разрезе номенклатуры типа Товар согласно реквизитам ТЧ Количество и Сумма
*** Движения по регистру накопления Расходы в разрезе номенклатуры типа Услуга согласно реквизиту ТЧ Сумма

### Применение скидок

Скидки определяются по срезу последних регистра сведений Скидки. Если скидка установлена и на конкретный элемент справочника Номенклатура, и на номенклатурную группу, приоритет имеет скидка для конкретного элемента.
Цена определяется по данным регистра сведений Цены и не пересчитывается при изменении скидки. Сумма определяется по цене с учетом скидки как:
   Сумма = Количество * Цена * (100 - Скидка) / 100
При изменении суммы изменяется скидка, но не цена, по обратной формуле:
   Скидка = 100 * (1 - Сумма / Количество / Цена)

### Правила расчета НДС

НДС рассчитывается по ставкам, определяемым по значению перечисления СтавкиНДС (БезНДС - 0%, НДС10 - 10%, НДС20 - 20%). Сумма НДС определяется умножением суммы на ставку (т.е. НДС рассчитывается по схеме "в том числе", например, для ставки 20% и суммы 120 р сумма НДС будет равна 120 * 0.2 / (1 + 0.2) = 20.
